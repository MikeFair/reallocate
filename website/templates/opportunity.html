{% extends 'theme/base.html' %}
{% load i18n %}

{% trans "This is the title" as the_title %}

{% block meta_description %}{{ the_title }}{% endblock %}


{% block extra_css %}
    <style>
        
    .sectionTitle {
        height: 50px;
        font-size: 2em;
        font-weight: 100;
    }

    .oppWell{
        margin-bottom: 20px;
        box-shadow: 1px 2px 3px #808080;
        -moz-box-shadow: 1px 2px 3px #808080;
        -webkit-box-shadow: 1px 2px 3px #808080;
        position: relative;
        padding: 6px;
        border-radius: 5px;
        background: #f5f5f5;
    }
    
    .oppContainer:hover {
        border-color: rgba(82, 168, 236, 0.8);
        box-shadow: 0 3px 3px rgba(0, 0, 0, 0.075) inset, 0 0 8px rgba(82, 168, 236, 0.6);
        cursor: pointer;
    }
    
    .oppImage{
        height: 161px;
    }
    /*.oppWell {*/
    /*    border-radius: 5px;*/
    /*    background: #f5f5f5;*/
    /*}*/


    
    .oppDescription{
        font-size: .9em
    }
    
    .explanation {
        padding-top: 10px;
        font-size: .9em
    }
    
    .oppLink {
        padding-top: 20px;
    }
    
    .oppLink a {
        font-size: 1.3em;
    }

    .updateRow {
        padding: 10px;
        margin-bottom: 15px;
        border-top: 1px solid rgba(81,114,131,.65);
        
    }
    .create_post{
        border: 2px blue;
    }

    #post_update textarea{
        width: 100%;
    }
    
    .hero {
        background-image:url('{{ project.media_url }}');
        background-size:cover;
        height: 200px;

    }
    
    .hero .inner {
        background-color: rgba(255, 255, 255, 0.8);
        height: 200px;
    }
    
    .skill-icons {
        font-weight:bold;
        color:#f2736a;
        margin: 0 auto;
    }
    
    .opp-skill-icons {
        font-weight:bold;
        color:#f2736a;
        float: right;
    }
    </style>
{% endblock %}

{% block widecontent %}

    <div class="container">
        <ul class="breadcrumb">
            <li id="breadcrumb-menu-home"><a href="/">Home</a><span class="divider">/</span></li>
            <li id="breadcrumb-menu-home"><a href="/project/{{ project.id }}">{{ project.name }}</a><span class="divider">/</span></li>
            <li id="breadcrumb-menu-mission" class="active">{{ opportunity.name }}</li>
        </ul>
    </div>

    <!-- Header: Project Image -->
    <div class="hero">
        <div class="container-fluid inner">
            <div class="container">
                <div class="row">
                    <div class="span10">
                        <h5>Opportunity</h5>
                        <h1>{{ opportunity.name }}</h1>
                        
                        <div class="skill-icons">
                            {% if opportunity.opp_type == 'skills' %}
                                <div class="give-icons"><i class="icon-fighter-jet icon-4x"></i><br/>Skills</div>
                            {% endif %}
                            
                            {% if opportunity.opp_type == 'knowledge' %}
                                <div class="give-icons"><i class="icon-book icon-4x"></i><br/>Knowledge</div>
                            {% endif %}
                        
                            {% if opportunity.opp_type == 'equipment' %}
                                <div class="give-icons"><i class="icon-cogs icon-4x"></i><br/>Equipment</div>
                            {% endif %}
                        
                            {% if opportunity.opp_type == 'money' %}
                                <div class="give-icons"><i class="icon-money icon-4x"></i><br/>Money</div>
                            {% endif %}
                        </div>
                        
                    </div>
                    <div class="span2">
                        <br/><br/>
                        
                        <a class="share addthis_button_twitter">
                            <i class="icon-twitter icon-2x" style="color: #4e7ac7;"></i>
                        </a>
                        <a class="share addthis_button_facebook">
                            <i class="icon-facebook icon-2x" style="color: #4e7ac7;"></i>
                        </a>
                        <a class="share addthis_button_linkedin">
                            <i class="icon-linkedin-sign icon-2x" style="color: #4e7ac7;"></i>
                        </a>
                        
                        {% if not is_engaged %}
                        <br/><br/>
                        <a class="btn btn-primary btn-large" href='/project/{{ project.id }}/opportunity/{{ opportunity.id }}/engage'>Engage</a>
                        {% endif %}
                            
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="project_wrap container-fluid">
        <div class="container-fluid">
            <div class="row-fluid oppoprtunityTop">
        
                <div class="span8">
                    <!--<div class="opp_image">
                        <img src="{{opportunity.media_url}}"/>
                    </div>-->
                    
                </div>
            </div>
        </div>
        
        
        <div class="container opportunityLower">
            <div class="row-fluid">   
                <div class="span8" id="updates">
                    
                    <div class="row-fluid">
                        <div class="span2"><h4>Description</h4></div>
                        <div class="span10 explanation">
                            {{ opportunity.description|safe }}
                        </div>
                    </div>
                    
                    <div class="row-fluid">
                        <div class="span2"><h4>Deliverables</h4></div>
                        <div class="span10 explanation">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas eu magna non felis venenatis adipiscing. Ut elementum bibendum nisi in accumsan. Curabitur imperdiet, lacus et mollis euismod, elit dui vestibulum nulla, eu bibendum leo metus condimentum nisl. Cras et diam a nunc pretium venenatis hendrerit vel metus. Quisque semper ornare tellus ut commodo.
                        </div>
                    </div>
                    
                    
                    <div class="row-fluid">
                        <div class="span2"><h4>Prerequisites</h4></div>
                        <div class="span10 explanation">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas eu magna non felis venenatis adipiscing. Ut elementum bibendum nisi in accumsan. Curabitur imperdiet, lacus et mollis euismod, elit dui vestibulum nulla, eu bibendum leo metus condimentum nisl. Cras et diam a nunc pretium venenatis hendrerit vel metus. Quisque semper ornare tellus ut commodo.
                        </div>
                    </div>
                    
                    <hr/>

                    <h3>Updates</h3>
                    {% if is_engaged %}
                    <div class="create_post">
                        <form id="post_update" enctype="multipart/form-data" method="post">
                            <input type="hidden" name="organization_id" value="{{organization.id}}"/>
                            <input type="hidden" name="project_id" value="{{project.id}}"/>
                            <input type="hidden" name="opportunity_id" value="{{opportunity.id}}"/>
                            <textarea name="update_text" placeholder="How is your project going?"></textarea>
                            
                            <button type="submit" class="btn">
                                <span class="icon-camera icon"></span>
                            </button>
                            
                            <input type="file" name="file" id="file" value="Upload a new photo"/>
                            <input class="btn btn-primary" type="submit" value="Post Update">
                            <input id="upload_button" type="file" name="uploaded_media" style="display: none;"/>
                            
                        </form>
                    </div>
                    {% endif %}

                    <a name="updates"></a>
                    {% for update in updates%}
                        <div class="row-fluid updateRow">
                            <div class="span2">
                                <img class="updateThumb" src="{{update.created_by.get_profile.media_url}}"/>
                            </div>
                            <div class="span10">
                                <a class="username" href="/profile/{{update.created_by.id}}">
                                    {{update.created_by.first_name}} {{update.created_by.last_name}}
                                </a>
                                <!--<div class="updateOppName"> {{update.opportunity.name}} </div>-->
                                <div class="updateText">  {{update.text|safe}}</div>
                                <div class="updateMedia"> <img width="100%" height="100%" src="{{ update.media_url }}"> </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="span4" id="related_opp_list">
                    <h3>Related Opportunities</h3>
                    
                        {% for opp in other_opps%}
                            <div class="oppWell">
                            <div class="oppContainer">
                                <div class="oppText">
                                    <h4>{{opp.name}}
                                    
                                    <div class="opp-skill-icons">
                                        {% if opp.opp_type == 'skills' %}
                                            <i class="icon-fighter-jet icon-2x"></i>
                                        {% endif %}
                                        
                                        {% if opp.opp_type == 'knowledge' %}
                                            <i class="icon-book icon-2x"></i>
                                        {% endif %}
                                    
                                        {% if opp.opp_type == 'equipment' %}
                                            <i class="icon-cogs icon-2x"></i>
                                        {% endif %}
                                    
                                        {% if opp.opp_type == 'money' %}
                                            <i class="icon-money icon-2x"></i>
                                        {% endif %}
                                    </div>
                                    
                                    </h4>
                                    <div class="oppDescription"> {{opp.short_desc|safe|truncatewords:15}}</div>
                                    <div class="oppLink">
                                        <a class="btn btn-primary" href="/opportunity/{{opp.id}}">Get Involved</a>
                                    </div>
                                    <br/>
                                </div>
                            </div>
                            </div>
                        {% endfor %}
                    
                </div>  
            </div>
        </div><!-- -->
    </div>
    
{% endblock %}

{% block bottomscript %}
<script>
    $(document).ready(function () {
        $('#target').submit(function() {
            alert('Handler for .submit() called.');
            return false;
        });
        
        $('#post_update').submit(function(event) {
            event.preventDefault();
            
            var form = $(this);
            
            if (form.find('textarea').val().length == 0) {
                alert('Please enter an update');
                return false;
            }
            
            var submit_button = form.find('input[type="submit"]');

            var file = form.find('input[type="file"]').get(0).files[0];
			var xhr = new XMLHttpRequest();
			

			//xhr.ontimeout = function() {
			//	this.abort();
			//	submission_error_cb();
			//	return;
			//}
			//xhr.onerror = submission_error_cb;
				
			xhr.onreadystatechange = function(e) {
				if (this.readyState != 4) { return; }
				
				if (this.status == 200 || this.status == 204) {
					var response = JSON.parse(this.responseText);
					console.log(response);
                    window.location.assign('#updates');
                    window.location.reload();
            
				} else if (this.status == 500 || this.status == 503) {
					alert('An error occurrred');
				}
			};
			xhr.timeout = 90000;
			xhr.open('post', '/ajax/add-update?' + form.serialize(), true);
			xhr.setRequestHeader("Content-Type", "application/octet-stream");
            xhr.setRequestHeader("X-Mime-Type", file.type);
			xhr.send(file);
            
            return false;   
        });
    var twitter_share_msg = "Check out the work being done on {{ opportunity.name }} for {{ project.name }} at @reallocate. " + window.location.href;
    var title = "Check out Reallocate";
    var description = "Check out the work we're doing : {{ opportunity.name }}.";
    reAllocate.setup_addthis(twitter=twitter_share_msg, title=title, description=description);
    });
</script>

{% endblock %}
